2015年12越8日，apache基金会宣布apache kylin从apache孵化器项目毕业，正式升级为顶级项目。这是第一个由中国团队完整贡献到apache的顶级项目，取名中国神兽---麒麟。kylin主要解决大数据在线多维统计过程面临的痛点：
> 1. 大数据做统计往往需要几十秒，十分钟，甚至几小时的处理时间，用户体验不好
> 2. 高并发量的大数据实时分析现有技术很难支撑

# 原理
kylin能够快速的响应高并发的大数据统计分析请求的根本原因是：**它提供提前做统计，并将统计结果存入缓存，当用户请求分析时，只需要从缓存中找到对应的统计结果的能力**。

# 架构
kylin依赖hadoop，hive，hbase大数据环境，主要提供了**构建统计模型**，**执行统计任务**，**缓存统计结果**，**根据sql查询统计结果**四方面主要的功能。其架构图如下：
![design]({{ site.url }}/assets/20171207/kylin.png)

### 构建统计模型
使用sql做统计时，有几个重要的步骤：
> 1. 构建表之间的关系。表之间是内连，左连接，还是右连接。连接字段是什么。
> 2. 确定分析纬度。对应sql中的groupby字段。
> 3. 确定统计值和统计函数。比如统计销售总额，平均考试分数等。

**kylin使用hive做数据源**。它使用**model**和**cube**两个概念来构建统计模型。model用来构建表关系，确定分析纬度等，完成数据模型定义；cube使用model构建的数据模型，并确定统计值和统计函数等，完成统计模型定义。

### 执行统计任务
kylin执行统计任务就是执行cube。kylin提供了mapreduce和spark两种cube执行引擎。

### 缓存统计结果
**kylin将统计结果存储在hbase中**。统计结果的最小存储单元是data segment，每个data segment都有对应的时间区间，左闭右开：[startTime,endtime)。如果每天执行一次cube，那么这个cube的就会有[2017-12-07,2017-12-08),[2017-12-08,2017-12-09)...等多个data segment。data segment可以被更新，多个也可以合并成一个。

### 根据sql查询统计结果
kylin使用apach calcite构建其搜索引擎，提供从hbase查询统计结果或者从hive统计的功能。

# 场景
如果有以下场景，非常适合使用kylin：
> 1. hadoop上存有百亿级别的数据，并需要提供快速的统计查询
> 2. 大数据BI工具。kylin提供了和BI工具的整合。

前东家是做舆情系统的，每天大概爬取亿级别的网络数据。其中有一个按天统计近3个月的数据量的功能，是基于solr做的，往往要等几十秒或者几分钟才能统计出来，而且很不稳定，并发量一上来，系统就撑不住了。可以尝试一下kylin，感受中国瑞兽的洪荒之力。
